{
  "session_id": "e91c461e-d935-40ca-9658-b10652d9eed9",
  "transcript_path": "C:\\Users\\gatli\\.claude\\projects\\C--Users-gatli-Projects-wigg\\e91c461e-d935-40ca-9658-b10652d9eed9.jsonl",
  "hook_event_name": "PreToolUse",
  "tool_name": "Edit",
  "tool_input": {
    "file_path": "C:\\Users\\gatli\\Projects\\wigg\\src\\components\\media\\MediaTile.tsx",
    "old_string": "            const { error: addErr } = await supabase.rpc('add_wigg', {\n              p_media_id: mediaId as string,\n              p_episode_id: null as any,\n              p_user_id: userId,\n              p_pos_kind: 'percent',\n              p_pos_value: pct,\n              p_span_start: null,\n              p_span_end: null,\n              p_tags: allTags,\n              p_reason_short: (res.note || '').slice(0, 140) || null,\n              p_spoiler,\n            } as any);\n\n            if (addErr) throw addErr;\n            // Update local UI approximation\n            try { await addWiggLocal?.(pct, res.note, res.rating); } catch {}",
    "new_string": "            if (useNewDataLayer) {\n              // Data layer handles everything including spoiler level and tags\n              // This prevents duplicate insertions since addWiggLocal now uses wiggPointsClient.createWiggPoint\n              await addWiggLocal?.(pct, res.note, res.rating, parseInt(p_spoiler));\n            } else {\n              // Legacy path: RPC + local state update\n              const { error: addErr } = await supabase.rpc('add_wigg', {\n                p_media_id: mediaId as string,\n                p_episode_id: null as any,\n                p_user_id: userId,\n                p_pos_kind: 'percent',\n                p_pos_value: pct,\n                p_span_start: null,\n                p_span_end: null,\n                p_tags: allTags,\n                p_reason_short: (res.note || '').slice(0, 140) || null,\n                p_spoiler,\n              } as any);\n\n              if (addErr) throw addErr;\n              // Update local UI approximation\n              try { await addWiggLocal?.(pct, res.note, res.rating); } catch {}\n            }"
  }
}